<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Trading Journal</title>  
    <link rel="preconnect" href="https://fonts.googleapis.com">  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">  
    <style>  
        body {  
            font-family: 'Roboto', sans-serif;  
            margin: 0;  
            padding: 20px;  
            transition: background-color 0.3s ease, color 0.3s ease;  
            background: linear-gradient(135deg, #e0f7fa, #e8f5e9, #fce4ec, #ede7f6, #fffde7);  
            color: #212121;  
        }  #journalForm, #tradeTableContainer {  
        max-width: 800px;  
        margin: 20px auto;  
    }  

    table {  
        width: 100%;  
        border-collapse: collapse;  
    }  

    th, td {  
        border: 1px solid #ddd;  
        padding: 8px;  
        text-align: left;  
    }  

    th {  
        background-color: #f2f2f2;  
    }  

    tr:nth-child(even) {  
        background-color: #f9f9f9;  
    }  

    tr:hover {  
        background-color: #e0e0e0;  
    }  

    input, select, textarea, button {  
        width: calc(100% - 20px);  
        padding: 10px;  
        margin-bottom: 10px;  
        border: 1px solid #ccc;  
        border-radius: 4px;  
        box-sizing: border-box;  
    }  

    button {  
        background-color: #03A9F4;  
        color: white;  
        cursor: pointer;  
    }  

    button:hover {  
        background-color: #0288D1;  
    }  

    @media (max-width: 600px) {  
        table {  
            display: block;  
            overflow-x: auto;  
            white-space: nowrap;  
        }  
    }  
</style>

</head>  
<body>  
    <div id="journalForm">  
        <h2>Add Trade Journal</h2>  
        <input type="hidden" id="tradeNumber">  
        <label for="scrip">Scrip:</label>  
        <select id="scrip">  
            <option value="" disabled selected>Choose Scrip</option>  
        </select>  
        <label for="optionFuture">Option/Future:</label>  
        <select id="optionFuture">  
            <option value="" disabled selected>Choose Option/Future</option>  
            <option value="Option">Option</option>  
            <option value="Future">Future</option>  
        </select>  
        <div id="optionFields" style="display: none;">  
            <label id="expiryLabel" for="expiryDate">Expiry Date:</label>  
            <input type="date" id="expiryDate">  
            <label id="strikeLabel" for="strikePrice">Strike Price:</label>  
            <input type="number" id="strikePrice">  
            <label id="expiryMonthLabel" for="expiryMonth">Expiry Month:</label>  
            <select id="expiryMonth">  
                <option value="" disabled selected>Choose Month</option>  
                <option value="January">January</option>  
                <option value="February">February</option>  
                <option value="March">March</option>  
                <option value="April">April</option>  
                <option value="May">May</option>  
                <option value="June">June</option>  
                <option value="July">July</option>  
                <option value="August">August</option>  
                <option value="September">September</option>  
                <option value="October">October</option>  
                <option value="November">November</option>  
                <option value="December">December</option>  
            </select>  
        </div>  
        <label for="buyPrice">Buy Price:</label>  
        <input type="number" id="buyPrice">  
        <label for="sellPrice">Sell Price:</label>  
        <input type="number" id="sellPrice">  
        <label for="stopLoss">Stop Loss:</label>  
        <input type="number" id="stopLoss">  
        <label for="targetPrice">Target Price:</label>  
        <input type="number" id="targetPrice">  
        <label for="reasonToBuy">Reason to Buy:</label>  
        <input type="text" id="reasonToBuy" placeholder="Enter reason to buy">  
        <label for="reasonToSell">Reason to Sell:</label>  
        <input type="text" id="reasonToSell" placeholder="Enter reason to sell">  
        <label for="date">Date:</label>  
        <input type="date" id="date">  
        <label for="notes">Notes:</label>  
        <textarea id="notes"></textarea>  
        <button id="addTrade">Add Trade</button>  
        <button id="saveChanges" style="display: none;">Save Changes</button>  
        <p>Risk: <span id="risk">N/A</span></p>  
        <p>Reward: <span id="reward">N/A</span></p>  
        <p>RRR: <span id="realTimeRRR">N/A</span></p>  
    </div>  
    <div id="tradeTableContainer">  
        <h2>Trade Logs</h2>  
        <table id="tradeTable">  
            <thead>  
                <tr>  
                    <th>Trade #</th>  
                    <th>Scrip</th>  
                    <th>Option/Future</th>  
                    <th>Buy Price</th>  
                    <th>Sell Price</th>  
                    <th>SL</th>  
                    <th>TGT</th>  
                    <th>RRR</th>  
                    <th>Reason to Buy</th>  
                    <th>Reason to Sell</th>  
                    <th>Date</th>  
                    <th>Notes</th>  
                    <th>P/L</th>  
                    <th>Expiry Date/Month</th>  
                    <th>Strike Price</th>  
                    <th>Edit</th>  
                </tr>  
            </thead>  
            <tbody></tbody>  
        </table>  
        <div id="tradeSummary">  
            <p>Total P/L: <span id="totalPL">0</span></p>  
            <p>Win Rate: <span id="winRate">0%</span></p>  
            <p>Total Trades: <span id="totalTrades">0</span></p>  
        </div>  
    </div>  
    <script>  
        document.addEventListener('DOMContentLoaded', function() {  
            const body = document.body;  
            const scripSelect = document.getElementById('scrip');  
            const tradeTableBody = document.querySelector('#tradeTable tbody');  
            const addTradeButton = document.getElementById('addTrade');  
            const saveChangesButton = document.getElementById('saveChanges');  
            const tradeNumberInput = document.getElementById('tradeNumber');  
            const scripInput = document.getElementById('scrip');  
            const optionFutureInput = document.getElementById('optionFuture');  
            const buyPriceInput = document.getElementById('buyPrice');  
            const sellPriceInput = document.getElementById('sellPrice');  
            const stopLossInput = document.getElementById('stopLoss');  
            const targetPriceInput = document.getElementById('targetPrice');  
            const reasonToBuyInput = document.getElementById('reasonToBuy');  
            const reasonToSellInput = document.getElementById('reasonToSell');  
            const dateInput = document.getElementById('date');  
            const notesInput = document.getElementById('notes');  
            const totalPLSpan = document.getElementById('totalPL');  
            const winRateSpan = document.getElementById('winRate');  
            const totalTradesSpan = document.getElementById('totalTrades');  
            const riskSpan = document.getElementById('risk');  
            const rewardSpan = document.getElementById('reward');  
            const realTimeRRRspan = document.getElementById('realTimeRRR');  
            const optionFields = document.getElementById('optionFields');  
            const expiryDateInput = document.getElementById('expiryDate');  
            const strikePriceInput = document.getElementById('strikePrice');  
            const expiryMonthInput = document.getElementById('expiryMonth');  
            const expiryLabel = document.getElementById('expiryLabel');  
            const strikeLabel = document.getElementById('strikeLabel');  
            const expiryMonthLabel = document.getElementById('expiryMonthLabel');  

            let trades = JSON.parse(localStorage.getItem('trades')) || [];  
            let editingTradeIndex = -1;  

            if (trades.length > 0) renderTrades(trades);

            const scrips = ['Nifty 50', 'BankNifty', 'NaturalGas', 'NaturalGasMini'];  
            scrips.forEach(scrip => {  
                const option = document.createElement('option');  
                option.value = scrip;  
                option.textContent = scrip;  
                scripSelect.appendChild(option);  
            });  

            function calculateRRR(buyPrice, stopLoss, targetPrice) {  
                if (!buyPrice || !stopLoss || !targetPrice) return 'N/A';  
                const risk = Math.abs(buyPrice - stopLoss);  
                const reward = Math.abs(targetPrice - buyPrice);  
                riskSpan.textContent = risk;  
                rewardSpan.textContent = reward;  
                if(risk === 0) return "N/A"  
                return `${(reward / risk).toFixed(2)}:1`;  
            }  

            function updateRRR() {  
                const buyPrice = parseFloat(buyPriceInput.value);  
                const stopLoss = parseFloat(stopLossInput.value);  
                const targetPrice = parseFloat(targetPriceInput.value);  
                realTimeRRRspan.textContent = calculateRRR(buyPrice, stopLoss, targetPrice);  
            }  

            buyPriceInput.addEventListener('input', updateRRR);  
            stopLossInput.addEventListener('input', updateRRR);  
            targetPriceInput.addEventListener('input', updateRRR);  

            optionFutureInput.addEventListener('change', () => {  
                optionFields.style.display = optionFutureInput.value === 'Option' || optionFutureInput.value === 'Future' ? 'block' : 'none';  
                if(optionFutureInput.value === 'Option') {  
                    expiryLabel.style.display = 'block';  
                    expiryDateInput.style.display = 'block';  
                    strikeLabel.style.display = 'block';  
                    strikePriceInput.style.display = 'block';  
                    expiryMonthLabel.style.display = 'none';  
                    expiryMonthInput.style.display = 'none';  
                } else if(optionFutureInput.value === 'Future') {  
                    expiryLabel.style.display = 'none';  
                    expiryDateInput.style.display = 'none';  
                    strikeLabel.style.display = 'none';  
                    strikePriceInput.style.display = 'none';  
                    expiryMonthLabel.style.display = 'block';  
                    expiryMonthInput.style.display = 'block';  
                }  
            });  

            function renderTrades(trades) {  
                tradeTableBody.innerHTML = '';  
                trades.forEach((trade, index) => {  
                    const row = document.createElement('tr');  
                    row.innerHTML = `  
                        <td>${trade.tradeNumber}</td>  
                        <td>${trade.scrip}</td>  
                        <td>${trade.optionFuture}</td>  
                        <td>${trade.buyPrice}</td>  
                        <td>${trade.sellPrice}</td>  
                        <td>${trade.stopLoss}</td>  
                        <td>${trade.targetPrice}</td>  
                        <td>${trade.rrr}</td>  
                        <td>${trade.reasonToBuy}</td>  
                        <td>${trade.reasonToSell}</td>  
                        <td>${trade.date}</td>  
                        <td>${trade.notes}</td>  
                        <td>${trade.profitLoss}</td>  
                        <td>${trade.expiryDate || trade.expiryMonth || 'N/A'}</td>  
                        <td>${trade.strikePrice || 'N/A'}</td>  
                        <td><button class="editTrade" data-index="${index}">Edit</button></td>  
                    `;  
                    tradeTableBody.appendChild(row);  
                });  
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.editTrade').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        editTrade(index);
                    });
                });
                
                updateSummary(trades);  
            }  

            function editTrade(index) {
                editingTradeIndex = index;
                const trade = trades[index];
                
                // Fill the form with trade data
                tradeNumberInput.value = trade.tradeNumber;
                scripInput.value = trade.scrip;
                optionFutureInput.value = trade.optionFuture;
                buyPriceInput.value = trade.buyPrice;
                sellPriceInput.value = trade.sellPrice;
                stopLossInput.value = trade.stopLoss;
                targetPriceInput.value = trade.targetPrice;
                reasonToBuyInput.value = trade.reasonToBuy;
                reasonToSellInput.value = trade.reasonToSell;
                dateInput.value = trade.date;
                notesInput.value = trade.notes;
                
                if (trade.optionFuture === 'Option') {
                    expiryDateInput.value = trade.expiryDate || '';
                    strikePriceInput.value = trade.strikePrice || '';
                } else if (trade.optionFuture === 'Future') {
                    expiryMonthInput.value = trade.expiryMonth || '';
                }
                
                // Trigger the option/future change to show correct fields
                optionFutureInput.dispatchEvent(new Event('change'));
                
                // Show save button and hide add button
                addTradeButton.style.display = 'none';
                saveChangesButton.style.display = 'block';
            }

            function updateSummary(trades) {  
                let totalPL = 0;  
                let wins = 0;  

                trades.forEach(trade => {  
                    totalPL += trade.profitLoss;  
                    if (trade.profitLoss > 0) wins++;  
                });  

                const winRate = trades.length > 0 ? ((wins / trades.length) * 100).toFixed(2) + '%' : '0%';  

                totalPLSpan.textContent = totalPL;  
                winRateSpan.textContent = winRate;  
                totalTradesSpan.textContent = trades.length;  
            }  

            function clearForm() {  
                scripInput.value = '';  
                optionFutureInput.value = '';  
                buyPriceInput.value = '';  
                sellPriceInput.value = '';  
                stopLossInput.value = '';  
                targetPriceInput.value = '';  
                reasonToBuyInput.value = '';  
                reasonToSellInput.value = '';  
                dateInput.value = '';  
                notesInput.value = '';  
                if(optionFutureInput.value === 'Option'){  
                    expiryDateInput.value = '';  
                    strikePriceInput.value = '';  
                }else if (optionFutureInput.value === 'Future'){  
                    expiryMonthInput.value = '';  
                }  
                optionFields.style.display = 'none';  
                
                // Reset edit mode
                editingTradeIndex = -1;
                addTradeButton.style.display = 'block';
                saveChangesButton.style.display = 'none';
            }  

            addTradeButton.addEventListener('click', () => {  
                const buyPrice = parseFloat(buyPriceInput.value);  
                const sellPrice = parseFloat(sellPriceInput.value);  
                const stopLoss = parseFloat(stopLossInput.value);  
                const targetPrice = parseFloat(targetPriceInput.value);  
                const rrr = calculateRRR(buyPrice, stopLoss, targetPrice);  
                const profitLoss = sellPrice - buyPrice;  

                const newTrade = {  
                    tradeNumber: trades.length + 1,  
                    scrip: scripInput.value,  
                    optionFuture: optionFutureInput.value,  
                    buyPrice: buyPrice,  
                    sellPrice: sellPrice,  
                    stopLoss: stopLoss,  
                    targetPrice: targetPrice,  
                    rrr: rrr,  
                    reasonToBuy: reasonToBuyInput.value,  
                    reasonToSell: reasonToSellInput.value,  
                    date: dateInput.value,  
                    notes: notesInput.value,  
                    profitLoss: profitLoss  
                };  
                if (optionFutureInput.value === 'Option') {  
                    newTrade.expiryDate = expiryDateInput.value;  
                    newTrade.strikePrice = strikePriceInput.value;  
                } else if (optionFutureInput.value === 'Future') {  
                    newTrade.expiryMonth = expiryMonthInput.value;  
                }  

                trades.push(newTrade);  
                localStorage.setItem('trades', JSON.stringify(trades));
                renderTrades(trades);  
                clearForm();  
            });  
            
            saveChangesButton.addEventListener('click', () => {
                if (editingTradeIndex === -1) return;
                
                const buyPrice = parseFloat(buyPriceInput.value);  
                const sellPrice = parseFloat(sellPriceInput.value);  
                const stopLoss = parseFloat(stopLossInput.value);  
                const targetPrice = parseFloat(targetPriceInput.value);  
                const rrr = calculateRRR(buyPrice, stopLoss, targetPrice);  
                const profitLoss = sellPrice - buyPrice;  

                const updatedTrade = {  
                    tradeNumber: trades[editingTradeIndex].tradeNumber, // Keep original trade number
                    scrip: scripInput.value,  
                    optionFuture: optionFutureInput.value,  
                    buyPrice: buyPrice,  
                    sellPrice: sellPrice,  
                    stopLoss: stopLoss,  
                    targetPrice: targetPrice,  
                    rrr: rrr,  
                    reasonToBuy: reasonToBuyInput.value,  
                    reasonToSell: reasonToSellInput.value,  
                    date: dateInput.value,  
                    notes: notesInput.value,  
                    profitLoss: profitLoss  
                };  
                
                if (optionFutureInput.value === 'Option') {  
                    updatedTrade.expiryDate = expiryDateInput.value;  
                    updatedTrade.strikePrice = strikePriceInput.value;  
                } else if (optionFutureInput.value === 'Future') {  
                    updatedTrade.expiryMonth = expiryMonthInput.value;  
                }  

                trades[editingTradeIndex] = updatedTrade;  
                localStorage.setItem('trades', JSON.stringify(trades));
                renderTrades(trades);  
                clearForm();  
            });
        });  
    </script>
</body>  
</html>